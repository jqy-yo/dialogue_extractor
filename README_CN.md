# ComfyUI å¯¹è¯æå–å™¨

[English Version](README.md)

ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„ ComfyUI æ’ä»¶ï¼Œç”¨äºä»å›¾åƒä¸­æå–å¯¹è¯æ–‡æœ¬å¹¶æä¾›é«˜çº§æ–‡ä»¶ç®¡ç†åŠŸèƒ½ã€‚

## èŠ‚ç‚¹æ¦‚è§ˆ

| èŠ‚ç‚¹åç§° | åŠŸèƒ½ç®€ä»‹ |
|---------|---------|
| **Dialogue Extractorï¼ˆå¯¹è¯æå–å™¨ï¼‰** | ä½¿ç”¨ OCR ä»å›¾åƒä¸­æå–å¯¹è¯/æ–‡æœ¬ï¼Œæ”¯æŒå¤šè¯­è¨€ |
| **Custom Image Saverï¼ˆè‡ªå®šä¹‰å›¾åƒä¿å­˜å™¨ï¼‰** | ä½¿ç”¨å¯è‡ªå®šä¹‰çš„å‘½åæ¨¡å¼å’Œæ–‡ä»¶å¤¹ç»“æ„ä¿å­˜å›¾åƒ |
| **Text Saverï¼ˆæ–‡æœ¬ä¿å­˜å™¨ï¼‰** | å°†æå–çš„æ–‡æœ¬ä¿å­˜åˆ°æ–‡ä»¶ï¼Œæ”¯æŒçµæ´»çš„å‘½åé€‰é¡¹ |
| **Sequential Image Loaderï¼ˆé¡ºåºå›¾åƒåŠ è½½å™¨ï¼‰** | ä»æ–‡ä»¶å¤¹ä¸­é¡ºåºæˆ–éšæœºåŠ è½½å›¾åƒï¼Œæ”¯æŒè‡ªç„¶æ’åº |

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” å¯¹è¯æå–å™¨ï¼ˆDialogue Extractorï¼‰
- **å¤šè¯­è¨€ OCR æ”¯æŒ**ï¼šåŸºäº PaddleOCRï¼Œæ”¯æŒ 80+ ç§è¯­è¨€ï¼ŒåŒ…æ‹¬ä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰
- **é«˜ç²¾åº¦è¯†åˆ«**ï¼šé‡‡ç”¨å…ˆè¿›çš„æ–‡æœ¬æ£€æµ‹å’Œè¯†åˆ«ç®—æ³•
- **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒåœ¨å·¥ä½œæµä¸­å¤„ç†å¤šå¼ å›¾åƒ
- **æ ¼å¼ä¿æŒ**ï¼šä¿ç•™æ–‡æœ¬å¸ƒå±€å’Œç»“æ„

**è¾“å…¥å‚æ•°ï¼š**
- `image`ï¼šè¾“å…¥å›¾åƒå¼ é‡
- `language`ï¼šOCR è¯­è¨€è®¾ç½®ï¼ˆé»˜è®¤ï¼šch - ä¸­æ–‡ï¼‰
  - é€‰é¡¹ï¼šchï¼ˆä¸­æ–‡ï¼‰ã€enï¼ˆè‹±æ–‡ï¼‰ã€japanï¼ˆæ—¥æ–‡ï¼‰ã€koreanï¼ˆéŸ©æ–‡ï¼‰ç­‰

**è¾“å‡ºï¼š**
- `text`ï¼šæå–çš„æ–‡æœ¬å†…å®¹

### ğŸ’¾ è‡ªå®šä¹‰å›¾åƒä¿å­˜å™¨ï¼ˆCustom Image Saverï¼‰
- **çµæ´»å‘½å**ï¼šæ”¯æŒæ—¶é—´æˆ³ã€è®¡æ•°å™¨å’Œè‡ªå®šä¹‰å‰ç¼€
- **è‡ªåŠ¨é€’å¢è®¡æ•°å™¨**ï¼šè‡ªåŠ¨ä¸ºä¿å­˜çš„å›¾åƒç¼–å·
- **è‡ªå®šä¹‰æ–‡ä»¶å¤¹**ï¼šåœ¨æŒ‡å®šç›®å½•ä¸­ç»„ç»‡è¾“å‡º
- **è´¨é‡æ§åˆ¶**ï¼šå¯è°ƒèŠ‚çš„å‹ç¼©è®¾ç½®

**è¾“å…¥å‚æ•°ï¼š**
- `images`ï¼šè¦ä¿å­˜çš„å›¾åƒå¼ é‡
- `output_folder`ï¼šä¿å­˜ç›®å½•è·¯å¾„ï¼ˆé»˜è®¤ï¼šComfyUI/output/dialogue_extractorï¼‰
- `filename_mode`ï¼šå‘½åæ¨¡å¼
  - `timestamp`ï¼šä½¿ç”¨å½“å‰æ—¶é—´æˆ³
  - `counter`ï¼šè‡ªåŠ¨é€’å¢æ•°å­—
  - `custom`ï¼šç”¨æˆ·è‡ªå®šä¹‰åç§°
- `filename_prefix`ï¼šæ–‡ä»¶åå‰ç¼€
- `image_format`ï¼šè¾“å‡ºæ ¼å¼ï¼ˆpng/jpg/webpï¼‰
- `quality`ï¼šjpg/webp çš„å‹ç¼©è´¨é‡ï¼ˆ1-100ï¼‰

### ğŸ“ æ–‡æœ¬ä¿å­˜å™¨ï¼ˆText Saverï¼‰
- **å¤šç§æ ¼å¼**ï¼šä¿å­˜ä¸º TXTã€JSON æˆ– Markdown
- **ç¼–ç é€‰é¡¹**ï¼šUTF-8ã€GBK ç­‰
- **è¿½åŠ æ¨¡å¼**ï¼šè¿½åŠ åˆ°ç°æœ‰æ–‡ä»¶æˆ–åˆ›å»ºæ–°æ–‡ä»¶
- **ç»“æ„åŒ–è¾“å‡º**ï¼šJSON æ ¼å¼åŒ–ä¾¿äºæ•°æ®å¤„ç†

**è¾“å…¥å‚æ•°ï¼š**
- `text`ï¼šè¦ä¿å­˜çš„æ–‡æœ¬å†…å®¹
- `output_folder`ï¼šä¿å­˜ç›®å½•
- `filename_mode`ï¼šåŒå›¾åƒä¿å­˜å™¨
- `filename_prefix`ï¼šè‡ªå®šä¹‰å‰ç¼€
- `file_format`ï¼štxt/json/md
- `encoding`ï¼šæ–‡ä»¶ç¼–ç ï¼ˆutf-8/gbk/gb2312ï¼‰
- `append_mode`ï¼šè¿½åŠ åˆ°ç°æœ‰æ–‡ä»¶æˆ–è¦†ç›–

### ğŸ–¼ï¸ é¡ºåºå›¾åƒåŠ è½½å™¨ï¼ˆSequential Image Loaderï¼‰
- **è‡ªç„¶æ’åº**ï¼šæ­£ç¡®æ’åºåŒ…å«æ•°å­—çš„æ–‡ä»¶ï¼ˆ1ã€2ã€10ã€20 è€Œé 1ã€10ã€2ã€20ï¼‰
- **å¤šç§æ¨¡å¼**ï¼šå›ºå®šç´¢å¼•ã€é€’å¢ã€é€’å‡æˆ–éšæœºé€‰æ‹©
- **çŠ¶æ€ä¿æŒ**ï¼šè®°ä½é¡ºåºæ“ä½œçš„ä½ç½®
- **æ ¼å¼æ”¯æŒ**ï¼šPNGã€JPGã€JPEGã€WebPã€BMPã€TIFFã€GIF

**è¾“å…¥å‚æ•°ï¼š**
- `folder_path`ï¼šåŒ…å«å›¾åƒçš„ç›®å½•
- `mode`ï¼šåŠ è½½æ¨¡å¼
  - `fixed`ï¼šå§‹ç»ˆåŠ è½½ç›¸åŒç´¢å¼•
  - `increment`ï¼šæ¯æ¬¡æ‰§è¡Œè‡ªåŠ¨é€’å¢
  - `decrement`ï¼šæ¯æ¬¡æ‰§è¡Œè‡ªåŠ¨é€’å‡
  - `random`ï¼šéšæœºé€‰æ‹©
- `index`ï¼šèµ·å§‹ç´¢å¼•ï¼ˆ0-99999ï¼‰
- `extensions`ï¼šæ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼ˆé€—å·åˆ†éš”ï¼‰
- `seed`ï¼šéšæœºæ¨¡å¼çš„éšæœºç§å­

**è¾“å‡ºï¼š**
- `image`ï¼šåŠ è½½çš„å›¾åƒå¼ é‡
- `filename`ï¼šä¸å«æ‰©å±•åçš„æ–‡ä»¶å
- `current_index`ï¼šæ–‡ä»¶å¤¹ä¸­çš„å½“å‰ä½ç½®
- `total_count`ï¼šå›¾åƒæ€»æ•°

## å®‰è£…æ–¹æ³•

### æ–¹æ³• 1ï¼šComfyUI Manager
1. æ‰“å¼€ ComfyUI Manager
2. æœç´¢ "Dialogue Extractor"
3. ç‚¹å‡»å®‰è£…

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨å®‰è£…
```bash
cd ComfyUI/custom_nodes
git clone https://github.com/jqy-yo/dialogue_extractor.git
cd dialogue_extractor
pip install -r requirements.txt
```

## ç³»ç»Ÿè¦æ±‚
- ComfyUI
- Python 3.8+
- PaddleOCR
- PaddlePaddle
- Pillow
- NumPy

## ä½¿ç”¨åœºæ™¯

### 1. æ¼«ç”»ç¿»è¯‘å·¥ä½œæµ
1. ä½¿ç”¨**é¡ºåºå›¾åƒåŠ è½½å™¨**åŠ è½½æ¼«ç”»é¡µé¢
2. åº”ç”¨**å¯¹è¯æå–å™¨**æå–æ–‡æœ¬
3. ç¿»è¯‘æ–‡æœ¬ï¼ˆé…åˆå…¶ä»–èŠ‚ç‚¹ï¼‰
4. ä½¿ç”¨**æ–‡æœ¬ä¿å­˜å™¨**ä¿å­˜ç»“æœ

### 2. æ‰¹é‡ OCR å¤„ç†
1. ä½¿ç”¨**é¡ºåºå›¾åƒåŠ è½½å™¨**ä»æ–‡ä»¶å¤¹åŠ è½½å›¾åƒ
2. ä½¿ç”¨**å¯¹è¯æå–å™¨**æå–æ–‡æœ¬
3. ä½¿ç”¨**è‡ªå®šä¹‰å›¾åƒä¿å­˜å™¨**å’Œ**æ–‡æœ¬ä¿å­˜å™¨**ä¿å­˜å¤„ç†åçš„å›¾åƒå’Œæ–‡æœ¬

### 3. æˆªå›¾æ–‡æœ¬æå–
1. å°†æˆªå›¾è¾“å…¥åˆ°**å¯¹è¯æå–å™¨**
2. æå–æ–‡æœ¬å†…å®¹
3. ä½¿ç”¨**æ–‡æœ¬ä¿å­˜å™¨**ä»¥ JSON/MD æ ¼å¼ä¿å­˜æ ¼å¼åŒ–æ–‡æœ¬

## å·¥ä½œæµç¤ºä¾‹

### åŸºç¡€ OCR å·¥ä½œæµ
```
[å›¾åƒè¾“å…¥] -> [å¯¹è¯æå–å™¨] -> [æ–‡æœ¬ä¿å­˜å™¨]
                        â”œ-> [æ˜¾ç¤ºæ–‡æœ¬]
                        â””-> [è¿›ä¸€æ­¥å¤„ç†]
```

### æ‰¹é‡å¤„ç†å·¥ä½œæµ
```
[é¡ºåºå›¾åƒåŠ è½½å™¨] -> [å¯¹è¯æå–å™¨] -> [æ–‡æœ¬ä¿å­˜å™¨]
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [è‡ªå®šä¹‰å›¾åƒä¿å­˜å™¨]
        â””-> [è®¡æ•°å™¨æ˜¾ç¤º]
```

## ä½¿ç”¨æŠ€å·§

1. **è¯­è¨€é€‰æ‹©**ï¼šé€‰æ‹©æ­£ç¡®çš„ OCR è¯­è¨€ä»¥è·å¾—æœ€ä½³æ•ˆæœ
2. **å›¾åƒè´¨é‡**ï¼šé«˜åˆ†è¾¨ç‡å›¾åƒèƒ½äº§ç”Ÿæ›´å¥½çš„ OCR ç»“æœ
3. **è‡ªç„¶æ’åº**ï¼šä½¿ç”¨å‰å¯¼é›¶å‘½åæ–‡ä»¶ï¼ˆ01ã€02ã€10ï¼‰ç¡®ä¿ä¸€è‡´çš„æ’åº
4. **å†…å­˜ç®¡ç†**ï¼šå¯¹äºå¤§æ‰¹é‡å¤„ç†ï¼Œåˆ†ç»„å¤„ç†ä»¥ç®¡ç†å†…å­˜ä½¿ç”¨

## æ•…éšœæ’é™¤

### PaddleOCR å®‰è£…é—®é¢˜
å¦‚æœé‡åˆ° PaddleOCR å®‰è£…é—®é¢˜ï¼š
```bash
pip install paddlepaddle -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install paddleocr
```

### GPU æ”¯æŒ
ä¸ºäº† GPU åŠ é€Ÿï¼š
```bash
# CUDA 11.6
pip install paddlepaddle-gpu==2.5.1 -i https://pypi.tuna.tsinghua.edu.cn/simple
```

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éšæ—¶æäº¤æ‹‰å–è¯·æ±‚æˆ–ä¸ºé”™è¯¯å’ŒåŠŸèƒ½è¯·æ±‚åˆ›å»ºé—®é¢˜ã€‚

## è®¸å¯è¯
MIT è®¸å¯è¯

## ä½œè€…
[jqy-yo](https://github.com/jqy-yo)

## è‡´è°¢
- ComfyUI å›¢é˜Ÿæä¾›çš„ä¼˜ç§€æ¡†æ¶
- PaddleOCR æä¾›çš„å¼ºå¤§ OCR åŠŸèƒ½
- ç¤¾åŒºè´¡çŒ®è€…

## ç›¸å…³é“¾æ¥
- [GitHub ä»“åº“](https://github.com/jqy-yo/dialogue_extractor)
- [ComfyUI](https://github.com/comfyanonymous/ComfyUI)
- [PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR)